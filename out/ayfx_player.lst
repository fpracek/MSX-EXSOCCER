                                      1 ;--------------------------------------------------------
                                      2 ; File Created by SDCC : free open source ANSI-C Compiler
                                      3 ; Version 4.2.0 #13081 (MINGW64)
                                      4 ;--------------------------------------------------------
                                      5 	.module ayfx_player
                                      6 	.optsdcc -mz80
                                      7 	
                                      8 ;--------------------------------------------------------
                                      9 ; Public variables in this module
                                     10 ;--------------------------------------------------------
                                     11 	.globl _ayFX_Finish
                                     12 	.globl _ayFX_Channel
                                     13 	.globl _ayFX_Priority
                                     14 	.globl _ayFX_Mode
                                     15 	.globl _ayFX_Volume
                                     16 	.globl _ayFX_Noise
                                     17 	.globl _ayFX_Tone
                                     18 	.globl _ayFX_Pointer
                                     19 	.globl _ayFX_Bank
                                     20 	.globl _ayFX_InitBank
                                     21 	.globl _ayFX_PlayBank
                                     22 	.globl _ayFX_Play
                                     23 	.globl _ayFX_Update
                                     24 	.globl _ayFX_Mute
                                     25 	.globl _ayFX_Stop
                                     26 ;--------------------------------------------------------
                                     27 ; special function registers
                                     28 ;--------------------------------------------------------
                         000000A8    29 _g_PortPrimarySlot	=	0x00a8
                         000000A9    30 _g_PortReadKeyboard	=	0x00a9
                         000000AA    31 _g_PortAccessKeyboard	=	0x00aa
                         000000AB    32 _g_PortControl	=	0x00ab
                         00000098    33 _g_VDP_DataPort	=	0x0098
                         00000099    34 _g_VDP_RegPort	=	0x0099
                         00000099    35 _g_VDP_AddrPort	=	0x0099
                         00000099    36 _g_VDP_StatPort	=	0x0099
                         000000A0    37 _g_PSG_RegPort	=	0x00a0
                         000000A1    38 _g_PSG_DataPort	=	0x00a1
                         000000A2    39 _g_PSG_StatPort	=	0x00a2
                         00000010    40 _g_PSG_Ext_RegPort	=	0x0010
                         00000011    41 _g_PSG_Ext_DataPort	=	0x0011
                         00000012    42 _g_PSG_Ext_StatPort	=	0x0012
                         0000007C    43 _g_MSXMusic_IndexPort	=	0x007c
                         0000007D    44 _g_MSXMusic_DataPort	=	0x007d
                         000000C0    45 _g_MSXAudio_IndexPort	=	0x00c0
                         000000C1    46 _g_MSXAudio_DataPort	=	0x00c1
                         000000C2    47 _g_MSXAudio_IndexPort2	=	0x00c2
                         000000C3    48 _g_MSXAudio_DataPort2	=	0x00c3
                         000000B4    49 _g_RTC_AddrPort	=	0x00b4
                         000000B5    50 _g_RTC_DataPort	=	0x00b5
                                     51 ;--------------------------------------------------------
                                     52 ; ram data
                                     53 ;--------------------------------------------------------
                                     54 	.area _DATA
    00000000                         55 _ayFX_Bank::
    00000000                         56 	.ds 2
    00000002                         57 _ayFX_Pointer::
    00000002                         58 	.ds 2
    00000004                         59 _ayFX_Tone::
    00000004                         60 	.ds 2
    00000006                         61 _ayFX_Noise::
    00000006                         62 	.ds 1
    00000007                         63 _ayFX_Volume::
    00000007                         64 	.ds 1
                                     65 ;--------------------------------------------------------
                                     66 ; ram data
                                     67 ;--------------------------------------------------------
                                     68 	.area _INITIALIZED
    00000000                         69 _ayFX_Mode::
    00000000                         70 	.ds 1
    00000001                         71 _ayFX_Priority::
    00000001                         72 	.ds 1
    00000002                         73 _ayFX_Channel::
    00000002                         74 	.ds 1
    00000003                         75 _ayFX_Finish::
    00000003                         76 	.ds 2
                                     77 ;--------------------------------------------------------
                                     78 ; absolute external ram data
                                     79 ;--------------------------------------------------------
                                     80 	.area _DABS (ABS)
                                     81 ;--------------------------------------------------------
                                     82 ; global & static initialisations
                                     83 ;--------------------------------------------------------
                                     84 	.area _HOME
                                     85 	.area _GSINIT
                                     86 	.area _GSFINAL
                                     87 	.area _GSINIT
                                     88 ;--------------------------------------------------------
                                     89 ; Home
                                     90 ;--------------------------------------------------------
                                     91 	.area _HOME
                                     92 	.area _HOME
                                     93 ;--------------------------------------------------------
                                     94 ; code
                                     95 ;--------------------------------------------------------
                                     96 	.area _CODE
                                     97 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:75: void ayFX_InitBank(void* bank) __NAKED
                                     98 ;	---------------------------------
                                     99 ; Function ayFX_InitBank
                                    100 ; ---------------------------------
    00000000                        101 _ayFX_InitBank::
                                    102 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:90: __endasm;
    00000000 22r00r00         [16]  103 	ld	(_ayFX_Bank), hl
    00000003 C9               [10]  104 	ret
                                    105 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:91: }	
                                    106 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:98: u8 ayFX_PlayBank(u8 id, u8 prio) __NAKED
                                    107 ;	---------------------------------
                                    108 ; Function ayFX_PlayBank
                                    109 ; ---------------------------------
    00000004                        110 _ayFX_PlayBank::
                                    111 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:179: __endasm;
    00000004 4D               [ 4]  112 	ld	c, l
    00000005 47               [ 4]  113 	ld	b, a
    00000006 2Ar00r00         [16]  114 	ld	hl, (_ayFX_Bank)
    00000009 7E               [ 7]  115 	ld	a, (hl)
    0000000A B7               [ 4]  116 	or	a
    0000000B 28 06            [12]  117 	jr	z, CHECK_PRIO
    0000000D                        118 	CHECK_INDEX:
    0000000D 78               [ 4]  119 	ld	a, b
    0000000E BE               [ 7]  120 	cp	(hl)
    0000000F 3E 02            [ 7]  121 	ld	a, #2
    00000011 30 21            [12]  122 	jr	nc, INIT_END
    00000013                        123 	CHECK_PRIO:
    00000013 78               [ 4]  124 	ld	a, b
    00000014 3Ar01r00         [13]  125 	ld	a, (_ayFX_Priority)
    00000017 B9               [ 4]  126 	cp	c
    00000018 3E 01            [ 7]  127 	ld	a, #1
    0000001A 38 18            [12]  128 	jr	c, INIT_END
    0000001C 79               [ 4]  129 	ld	a, c
    0000001D E6 0F            [ 7]  130 	and	#0x0F
    0000001F 32r01r00         [13]  131 	ld	(_ayFX_Priority), a
    00000022 ED 5Br00r00      [20]  132 	ld	de, (_ayFX_Bank)
    00000026 13               [ 6]  133 	inc	de
    00000027 68               [ 4]  134 	ld	l, b
    00000028 26 00            [ 7]  135 	ld	h, #0
    0000002A 29               [11]  136 	add	hl, hl
    0000002B 19               [11]  137 	add	hl, de
    0000002C 5E               [ 7]  138 	ld	e, (hl)
    0000002D 23               [ 6]  139 	inc	hl
    0000002E 56               [ 7]  140 	ld	d, (hl)
    0000002F 19               [11]  141 	add	hl, de
    00000030 22r02r00         [16]  142 	ld	(_ayFX_Pointer), hl
    00000033 AF               [ 4]  143 	xor	a
    00000034                        144 	INIT_END:
    00000034 C9               [10]  145 	ret
                                    146 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:180: }
                                    147 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:185: void ayFX_Play(void* data) __NAKED
                                    148 ;	---------------------------------
                                    149 ; Function ayFX_Play
                                    150 ; ---------------------------------
    00000035                        151 _ayFX_Play::
                                    152 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:194: __endasm;
    00000035 22r02r00         [16]  153 	ld	(_ayFX_Pointer), hl
    00000038 AF               [ 4]  154 	xor	a
    00000039 32r01r00         [13]  155 	ld	(_ayFX_Priority), a
    0000003C C9               [10]  156 	ret
                                    157 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:195: }
                                    158 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:199: void ayFX_Update() __NAKED
                                    159 ;	---------------------------------
                                    160 ; Function ayFX_Update
                                    161 ; ---------------------------------
    0000003D                        162 _ayFX_Update::
                                    163 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:331: __endasm;
    0000003D 3Ar01r00         [13]  164 	ld	a, (_ayFX_Priority)
    00000040 B7               [ 4]  165 	or	a
    00000041 F8               [11]  166 	ret	m
    00000042 3Ar00r00         [13]  167 	ld	a, (_ayFX_Mode)
    00000045 E6 01            [ 7]  168 	and	#1
    00000047 28 08            [12]  169 	jr	z, TAKECB
    00000049                        170 	CHANNEL_SWITCH:
    00000049 21r02r00         [10]  171 	ld	hl, #_ayFX_Channel
    0000004C 35               [11]  172 	dec	(hl)
    0000004D 20 02            [12]  173 	jr	nz, TAKECB
    0000004F 36 03            [10]  174 	ld	(hl), #3
    00000051                        175 	TAKECB:
    00000051 2Ar02r00         [16]  176 	ld	hl, (_ayFX_Pointer)
    00000054 4E               [ 7]  177 	ld	c, (hl)
    00000055 23               [ 6]  178 	inc	hl
    00000056 CB 69            [ 8]  179 	bit	5, c
    00000058 28 08            [12]  180 	jr	z, CHECK_NN
    0000005A 5E               [ 7]  181 	ld	e, (hl)
    0000005B 23               [ 6]  182 	inc	hl
    0000005C 56               [ 7]  183 	ld	d, (hl)
    0000005D 23               [ 6]  184 	inc	hl
    0000005E ED 53r04r00      [20]  185 	ld	(_ayFX_Tone), de
    00000062                        186 	CHECK_NN:
    00000062 CB 71            [ 8]  187 	bit	6, c
    00000064 28 0D            [12]  188 	jr	z, SETPOINTER
    00000066 7E               [ 7]  189 	ld	a, (hl)
    00000067 23               [ 6]  190 	inc	hl
    00000068 FE 20            [ 7]  191 	cp	#0x20
    0000006A 20 04            [12]  192 	jr	nz, CONTINUE
    0000006C 2Ar03r00         [16]  193 	ld	hl, (_ayFX_Finish)
    0000006F E9               [ 4]  194 	jp	(hl)
    00000070                        195 	CONTINUE:
    00000070 32r06r00         [13]  196 	ld	(_ayFX_Noise), a
    00000073                        197 	SETPOINTER:
    00000073 22r02r00         [16]  198 	ld	(_ayFX_Pointer), hl
    00000076 79               [ 4]  199 	ld	a, c
    00000077 E6 0F            [ 7]  200 	and	#0x0F
    00000079 32r07r00         [13]  201 	ld	(_ayFX_Volume), a
    0000007C C8               [11]  202 	ret	z
    0000007D CB 79            [ 8]  203 	bit	7, c
    0000007F 20 06            [12]  204 	jr	nz, SETMASKS
    00000081 3Ar06r00         [13]  205 	ld	a, (_ayFX_Noise)
    00000084 32r06r00         [13]  206 	ld	(_PT3_Regs+6), a
    00000087                        207 	SETMASKS:
    00000087 79               [ 4]  208 	ld	a, c
    00000088 E6 90            [ 7]  209 	and	#0x90
    0000008A FE 90            [ 7]  210 	cp	#0x90
    0000008C C8               [11]  211 	ret	z
    0000008D 0F               [ 4]  212 	rrca
    0000008E 0F               [ 4]  213 	rrca
    0000008F 16 DB            [ 7]  214 	ld	d, #0xDB
    00000091 21r02r00         [10]  215 	ld	hl, #_ayFX_Channel
    00000094 46               [ 7]  216 	ld	b, (hl)
    00000095                        217 	CHK1:
    00000095 10 0D            [13]  218 	djnz	CHK2
    00000097                        219 	PLAY_C:
    00000097 CDrC6r00         [17]  220 	call	SETMIXER
    0000009A 32r0Ar00         [13]  221 	ld	(_PT3_Regs+10), a
    0000009D CB 51            [ 8]  222 	bit	2, c
    0000009F C0               [11]  223 	ret	nz
    000000A0 22r04r00         [16]  224 	ld	(_PT3_Regs+4), hl
    000000A3 C9               [10]  225 	ret
    000000A4                        226 	CHK2:
    000000A4 CB 0A            [ 8]  227 	rrc	d
    000000A6 0F               [ 4]  228 	rrca
    000000A7 10 0D            [13]  229 	djnz	CHK3
    000000A9                        230 	PLAY_B:
    000000A9 CDrC6r00         [17]  231 	call	SETMIXER
    000000AC 32r09r00         [13]  232 	ld	(_PT3_Regs+9), a
    000000AF CB 49            [ 8]  233 	bit	1, c
    000000B1 C0               [11]  234 	ret	nz
    000000B2 22r02r00         [16]  235 	ld	(_PT3_Regs+2), hl
    000000B5 C9               [10]  236 	ret
    000000B6                        237 	CHK3:
    000000B6 CB 0A            [ 8]  238 	rrc	d
    000000B8 0F               [ 4]  239 	rrca
    000000B9                        240 	PLAY_A:
    000000B9 CDrC6r00         [17]  241 	call	SETMIXER
    000000BC 32r08r00         [13]  242 	ld	(_PT3_Regs+8), a
    000000BF CB 41            [ 8]  243 	bit	0, c
    000000C1 C0               [11]  244 	ret	nz
    000000C2 22r00r00         [16]  245 	ld	(_PT3_Regs+0), hl
    000000C5 C9               [10]  246 	ret
    000000C6                        247 	SETMIXER:
    000000C6 4F               [ 4]  248 	ld	c, a
    000000C7 3Ar07r00         [13]  249 	ld	a, (_PT3_Regs+7)
    000000CA A2               [ 4]  250 	and	d
    000000CB B1               [ 4]  251 	or	c
    000000CC 32r07r00         [13]  252 	ld	(_PT3_Regs+7), a
    000000CF 3Ar07r00         [13]  253 	ld	a, (_ayFX_Volume)
    000000D2 2Ar04r00         [16]  254 	ld	hl, (_ayFX_Tone)
    000000D5 C9               [10]  255 	ret
                                    256 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:332: }
                                    257 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:336: void ayFX_Mute() __NAKED
                                    258 ;	---------------------------------
                                    259 ; Function ayFX_Mute
                                    260 ; ---------------------------------
    000000D6                        261 _ayFX_Mute::
                                    262 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:361: __endasm;
    000000D6 3E FF            [ 7]  263 	ld	a, #255
    000000D8 32r01r00         [13]  264 	ld	(_ayFX_Priority), a
    000000DB 21r02r00         [10]  265 	ld	hl, #_ayFX_Channel
    000000DE 46               [ 7]  266 	ld	b, (hl)
    000000DF AF               [ 4]  267 	xor	a
    000000E0                        268 	StopCheck1:
    000000E0 10 04            [13]  269 	djnz	StopCheck2
    000000E2 32r0Ar00         [13]  270 	ld	(_PT3_Regs+10), a
    000000E5 C9               [10]  271 	ret
    000000E6                        272 	StopCheck2:
    000000E6 10 04            [13]  273 	djnz	StopCheck3
    000000E8 32r09r00         [13]  274 	ld	(_PT3_Regs+9), a
    000000EB C9               [10]  275 	ret
    000000EC                        276 	StopCheck3:
    000000EC 32r08r00         [13]  277 	ld	(_PT3_Regs+8), a
    000000EF C9               [10]  278 	ret
                                    279 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:362: }
                                    280 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:366: void ayFX_Stop() __NAKED
                                    281 ;	---------------------------------
                                    282 ; Function ayFX_Stop
                                    283 ; ---------------------------------
    000000F0                        284 _ayFX_Stop::
                                    285 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:373: __endasm;
    000000F0 3E FF            [ 7]  286 	ld	a, #255
    000000F2 32r01r00         [13]  287 	ld	(_ayFX_Priority), a
    000000F5 C9               [10]  288 	ret
                                    289 ;E:\Dropbox\FAUSTO\SVILUPPI\MSX\CODE\C\MSXgl\engine/src/ayfx/ayfx_player.c:374: }
                                    290 	.area _CODE
                                    291 	.area _INITIALIZER
    00000000                        292 __xinit__ayFX_Mode:
    00000000 00                     293 	.db #0x00	; 0
    00000001                        294 __xinit__ayFX_Priority:
    00000001 FF                     295 	.db #0xff	; 255
    00000002                        296 __xinit__ayFX_Channel:
    00000002 01                     297 	.db #0x01	; 1
    00000003                        298 __xinit__ayFX_Finish:
    00000003rD6r00                  299 	.dw _ayFX_Mute
                                    300 	.area _CABS (ABS)
